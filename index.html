<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVR Super Gold | Premium</title>
    <style>
        :root { --gold: #D4AF37; --bg: #050505; --error: #ff4d4d; }
        body, html { margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: white; overflow: hidden; height: 100%; }
        
        #booking-page { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; padding: 20px; box-sizing: border-box; }
        .container { width: 100%; max-width: 380px; text-align: center; }

        h1 { color: var(--gold); text-transform: uppercase; letter-spacing: 6px; font-size: 24px; margin: 0 0 30px 0; }

        .balance-card {
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.3);
            padding: 20px; border-radius: 16px; margin-bottom: 25px; cursor: pointer;
        }

        .balance-label { font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 4px; }
        .balance-value { font-size: 22px; color: var(--gold); font-weight: bold; }

        .input-box { margin-bottom: 18px; text-align: left; }
        label { display: block; font-size: 10px; color: var(--gold); text-transform: uppercase; margin-bottom: 8px; font-weight: bold; }
        
        select, input {
            width: 100%; padding: 14px; background: #111; border: 1px solid #222;
            border-radius: 10px; color: white; font-size: 16px; box-sizing: border-box; outline: none;
        }

        .method-toggle { display: flex; gap: 10px; }
        .m-btn {
            flex: 1; padding: 12px; background: #111; border: 1px solid #222;
            color: #666; border-radius: 8px; cursor: pointer; transition: 0.3s;
        }
        .m-btn.active { border-color: var(--gold); color: var(--gold); background: rgba(212, 175, 55, 0.1); }

        #price-display { color: var(--gold); font-size: 14px; margin-top: 10px; font-weight: bold; }

        /* Active Ticket Bar */
        #active-ticket-bar {
            display: none; width: 100%; background: var(--gold); color: black;
            padding: 15px; border-radius: 12px; margin-top: 20px; cursor: pointer;
            font-weight: bold; text-transform: uppercase; letter-spacing: 1px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        #error-display {
            color: var(--error); font-size: 13px; margin-top: 15px; display: none;
            background: rgba(255, 77, 77, 0.1); padding: 10px; border-radius: 8px; border: 1px solid var(--error);
        }

        .confirm-btn {
            width: 100%; padding: 18px; background: var(--gold); color: black;
            border: none; border-radius: 12px; font-weight: bold; font-size: 15px;
            text-transform: uppercase; margin-top: 15px; cursor: pointer;
        }

        /* Ticket Page */
        #ticket-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #ffffff; color: #000; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .ticket-title { font-size: 22px; font-weight: 900; letter-spacing: 2px; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 5px; }
        #qrcode { padding: 15px; background: #fff; margin-bottom: 30px; border: 1px solid #eee; }
        
        .details-grid { width: 85%; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px; }
        .detail-item { border-left: 1px solid #ddd; padding-left: 10px; }
        .detail-label { font-size: 9px; color: #999; text-transform: uppercase; }
        .detail-val { font-size: 14px; font-weight: bold; }

        .close-btn { padding: 14px 40px; border: 1px solid #000; background: #000; color: #fff; border-radius: 50px; cursor: pointer; text-transform: uppercase; font-size: 12px; }
    </style>
</head>
<body>

    <div id="booking-page">
        <div class="container">
            <h1>PVR Super Gold</h1>

            <div class="balance-card" onclick="adminReset()">
                <div class="balance-label">Device Balance</div>
                <div class="balance-value" id="balanceText">100 Points</div>
            </div>

            <div class="input-box">
                <label>Movie Selection</label>
                <select id="movie">
                    <option value="Avatar: Way of Water">Avatar: The Way of Water</option>
                    <option value="The Dark Knight">The Dark Knight</option>
                    <option value="Gladiator II">Gladiator II</option>
                </select>
            </div>

            <div class="input-box">
                <label>Seats</label>
                <input type="number" id="seats" value="1" min="1" oninput="updateUI()">
            </div>

            <div class="input-box">
                <label>Payment Mode</label>
                <div class="method-toggle">
                    <button class="m-btn active" id="ptsBtn" onclick="setMethod('points')">Points</button>
                    <button class="m-btn" id="cashBtn" onclick="setMethod('cash')">Cash</button>
                </div>
                <div id="price-display">Price: 100 Points</div>
            </div>

            <div id="error-display">Insufficient Points for this Device.</div>

            <button class="confirm-btn" id="mainBookBtn" onclick="openTicket()">Confirm Booking</button>

            <div id="active-ticket-bar" onclick="showExistingTicket()">
                Ticket: <span id="booked-movie-name">None</span>
            </div>
        </div>
    </div>

    <div id="ticket-page">
        <div class="ticket-title">PVR SUPER GOLD</div>
        <div id="qrcode"></div>
        <div class="details-grid">
            <div class="detail-item"><div class="detail-label">Movie</div><div class="detail-val" id="t-movie">---</div></div>
            <div class="detail-item"><div class="detail-label">Seats</div><div class="detail-val" id="t-seats">---</div></div>
            <div class="detail-item"><div class="detail-label">Payment</div><div class="detail-val" id="t-method">---</div></div>
            <div class="detail-item"><div class="detail-label">Entry</div><div class="detail-val">Super Gold</div></div>
        </div>
        <button class="close-btn" onclick="closeTicket()">Back to Home</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        let balance = parseInt(localStorage.getItem('pvr_balance')) || 100;
        let method = 'points';
        let clickCount = 0;
        let currentTicket = JSON.parse(localStorage.getItem('active_ticket')) || null;

        window.onload = () => {
            document.getElementById('balanceText').innerText = `${balance} Points`;
            if(currentTicket) { showTicketBar(); }
            updateUI();
        };

        function updateUI() {
            const seats = parseInt(document.getElementById('seats').value) || 1;
            const display = document.getElementById('price-display');
            if (method === 'points') {
                display.innerText = `Price: ${seats * 100} Points`;
            } else {
                display.innerText = `Price: â‚¹${seats * 500} Cash`;
            }
            document.getElementById('error-display').style.display = 'none';
        }

        function setMethod(m) {
            method = m;
            document.getElementById('ptsBtn').classList.toggle('active', m === 'points');
            document.getElementById('cashBtn').classList.toggle('active', m === 'cash');
            updateUI();
        }

        function openTicket() {
            const movie = document.getElementById('movie').value;
            const seats = parseInt(document.getElementById('seats').value) || 1;
            const cost = seats * 100;

            if (method === 'points' && balance < cost) {
                document.getElementById('error-display').style.display = 'block';
                return;
            }

            if (method === 'points') {
                balance -= cost;
                localStorage.setItem('pvr_balance', balance);
                document.getElementById('balanceText').innerText = `${balance} Points`;
            }

            // Save Ticket Data
            currentTicket = { movie, seats, method: method.toUpperCase() };
            localStorage.setItem('active_ticket', JSON.stringify(currentTicket));
            
            showExistingTicket();
            showTicketBar();
        }

        function showTicketBar() {
            document.getElementById('active-ticket-bar').style.display = 'block';
            document.getElementById('booked-movie-name').innerText = currentTicket.movie;
        }

        function showExistingTicket() {
            if(!currentTicket) return;
            document.getElementById('t-movie').innerText = currentTicket.movie;
            document.getElementById('t-seats').innerText = currentTicket.seats;
            document.getElementById('t-method').innerText = currentTicket.method;

            document.getElementById("qrcode").innerHTML = "";
            new QRCode(document.getElementById("qrcode"), {
                text: `PVR-SG|${currentTicket.movie}|SEATS:${currentTicket.seats}|PAY:${currentTicket.method}`,
                width: 180, height: 180
            });
            document.getElementById('ticket-page').style.display = 'flex';
        }

        function closeTicket() {
            document.getElementById('ticket-page').style.display = 'none';
        }

        function adminReset() {
            clickCount++;
            if (clickCount >= 5) {
                balance = 100;
                localStorage.clear();
                localStorage.setItem('pvr_balance', 100);
                location.reload();
            }
        }
    </script>
</body>
</html>
